<!doctype html>
<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorator="fragments/adminModel">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>网上购物系统</title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <style>
        .container {
            background: cornsilk;
        }
        img{
            width: 100%;
        }
        ul{
            border: 0;
        }
        .list-group-item{
            margin-bottom: 0;
            border: 0;
            border-bottom: 1px dashed #ddd;
            background-color: inherit;
        }
        .list2{
            border-bottom: 0;
        }
        .panel-default>.panel-heading {
            color: #e4393c;
            background-color: #f7f7f7;
            border-color: #fff;
        }
        .panel-default {
             border-color: #fff;
        }
        .panel-group .panel-heading+.panel-collapse>.panel-body {
             border-top: 1px solid #fff;
        }
        .save {
            padding: 6px 30px;
        }
        .active{
            background-color: #ff780e;
        }
        .mmqd{
            width: 290px;
            height: 30px;
            background-color:rgba(255, 120, 14, 0.58);
            line-height: 30px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .mmqd em{
            display: inline-block;
            width: 33.333%;
            text-align: center;
            color: #fff;

        }
        #reviseSubmit{
            text-decoration:none;
        }

    </style>
</head>
<body>
<!--顶部导航-->
<div th:replace="../templates/top-part"></div>
<!--<div id="search-part"></div>-->

<!--主体内容-->
<div class="container">
    <div class="row">
        <div class="col-md-3" style="background: #f7f7f7" >
            <ul class="list-group">
                <li  class="list-group-item" id="userimg-part"></li>
                <li class="list-group-item">账号设置
                    <ul class="list-group">
                        <li class="list-group-item list2">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">基本信息</a>
                        </li>
                        <li class="list-group-item list2">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">密码修改</a>
                        </li>
                        <li class="list-group-item list2">
                            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">其它信息</a>
                        </li>
                    </ul>
                </li>

                <li class="list-group-item">我的钱包</li>
                <li class="list-group-item">我的理财</li>
                <li class="list-group-item">地址管理</li>
                <li class="list-group-item">安全设置</li>
            </ul>
        </div>
        <div class="col-md-8">
            <div class="panel-group" id="accordion1" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingOne">
                        <h4 class="panel-title">
                            <a role="button" data-toggle="collapse" data-parent="#accordion1" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                基本信息
                            </a>
                        </h4>
                    </div>
                    <div id="collapseOne" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingOne">
                        <div class="panel-body">
                            <div class="col-md-offset-1 col-md-7">
                                <form class="form-horizontal" style="margin-top: 40px" action="/user/reviseUserInfo" id="reviseForm">
                                    <div class="form-group">
                                        <label for="userName" class="col-sm-2 control-label">用户名</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="userName" id="userName" th:value="${user.userName}" readonly="true" >
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="relName" class="col-sm-2 control-label">真实姓名</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="relName" id="relName" th:value="${user.relName}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="address" class="col-sm-2 control-label">家庭住址</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="address" id="address" th:value="${user.address}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="telephone" class="col-sm-2 control-label">电话号码</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="telephone" id="telephone" th:value="${user.telephone}">
                                            <span id="telephoneRequierdSpan" class="reviseRequierdSpan" style="color: red;font-size: 10px"></span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="email" class="col-sm-2 control-label">电子邮件</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" name="email" id="email" th:value="${user.email}">
                                            <span id="emailRequierdSpan" class="reviseRequierdSpan" style="color: red;font-size: 10px"></span>

                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="birthday" class="col-sm-2 control-label">出生日期</label>
                                        <div class="col-sm-10">
                                            <input type="date" class="form-control" name="birthday" id="birthday" th:value="${user.birthday}">
                                        </div>
                                    </div>
                                    <div class="form-group" >
                                        <label  class="col-sm-2 control-label">性别</label>
                                        <label class="radio-inline" style=" padding-left:40px"><input type="radio" id="genderMale" value="男" name="gender">男</label>
                                        <input type="hidden" id="genderValue" th:value="${user.gender}">
                                        <label class="radio-inline"><input type="radio"  id="genderFemale" value="女" name="gender">女</label>

                                    </div>
                                    <div class="form-group">
                                        <div class="col-sm-offset-3 col-sm-8">
                                            <a href="javascript:void(0);" id="reviseSubmit"><button type="button" class="btn btn-success save">保存</button></a>
                                            <!--<button type="submit" class="btn btn-success save" id="reviseSubmit">保存</button> -->
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingTwo">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion1" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                修改密码
                            </a>
                        </h4>
                    </div>
                    <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
                        <div class="panel-body">
                            <div class="col-md-offset-1 col-md-7">
                                <form class="form-horizontal" style="margin-top: 40px" >
                                    <div class="form-group">
                                        <label for="input6" class="col-sm-2 control-label">新密码</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control" id="input6" >
                                            <span style="color: red;font-size: 20px"> *</span>
                                            <span id="passwordRequierdSpan" class="requierdSpan" style="color: red;font-size: 10px"></span>
                                            <input type="hidden" id="newPwd">
                                        </div>
                                    </div>
                                    <div class="mmqd" style="margin-left: 90px">
                                        <em class="active">弱</em><em>中</em><em>强</em>
                                    </div>
                                    <div class="form-group">
                                        <label for="input7" class="col-sm-2 control-label">确认密码</label>
                                        <div class="col-sm-10">
                                            <input type="password" class="form-control" id="input7" >
                                            <span style="color: red;font-size: 20px"> *</span>
                                            <span id="passwordAgainRequierdSpan" class="requierdSpan" style="color: red;font-size: 10px"></span>
                                            <input type="hidden" id="checkPwd">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="checkCode" class="col-sm-2 control-label">验证码</label>
                                        <div class="col-sm-10">
                                            <input type="text" class="form-control" id="checkCode" placeholder="请到您的邮箱查看">
                                            <span style="color: red;font-size: 20px"> *</span>
                                            <span id="codeRequierdSpan" class="requierdSpan" style="color: red;font-size: 10px"></span>
                                            <input type="hidden" id="checkMail">
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-success save" id="getCode" style="margin-left: 90px;margin-bottom: 5px">获取验证码</button>
                                    <input type="hidden" id="codeValue">
                                    <div class="form-group">
                                        <div class="col-sm-offset-3 col-sm-8">
                                             <button type="button" class="btn btn-success save" onclick="RPwd()" >修改</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel panel-default">
                    <div class="panel-heading" role="tab" id="headingThree">
                        <h4 class="panel-title">
                            <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion1" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                其它信息
                            </a>
                        </h4>
                    </div>
                    <!--<div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">-->
                        <!--<div class="panel-body">-->
                            <!--<div class="col-md-offset-1 col-md-7">-->
                                <!--<form class="form-horizontal" style="margin-top: 40px">-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="input11" class="col-sm-2 control-label">昵称</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="text" class="form-control" id="input11" placeholder="昵称">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="input12" class="col-sm-2 control-label">word</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="text" class="form-control" id="input12" placeholder="word">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="input13" class="col-sm-2 control-label">昵称</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="text" class="form-control" id="input13" placeholder="昵称">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="input14" class="col-sm-2 control-label">word</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="text" class="form-control" id="input14" placeholder="word">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="form-group">-->
                                        <!--<label for="input15" class="col-sm-2 control-label">word</label>-->
                                        <!--<div class="col-sm-10">-->
                                            <!--<input type="text" class="form-control" id="input15" placeholder="word">-->
                                        <!--</div>-->
                                    <!--</div>-->
                                    <!--<div class="form-group">-->
                                        <!--<div class="col-sm-offset-3 col-sm-8">-->
                                            <!--<button type="button" class="btn btn-success save">重置</button>-->
                                            <!--<button type="button" class="btn btn-success save">保存</button>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</form>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>


    </div>
</div>
</body>
<script src="/js/jquery-1.11.0.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script type="text/javascript">
    $("#top-part").load("/top-part.html");
    $("#search-part").load("/search-part.html");
    $("#userimg-part").load("/userimg-part.html");
    var gender = $("#genderValue").val().toString();
    var male = "男".toString();
    var female = "女".toString();
    $(function () {
        if (gender == male){
            $("#genderMale").attr("checked","checked");
        }
        else if (gender == female) {
            $("#genderFemale").attr("checked","checked");
        }
    });
    $("#email").blur(function() {
        var email=this.value;
        email=$.trim(email);
        if(email==""){
            $("#emailRequierdSpan").text("邮箱不能为空");
        }else{
            var regExp = /^[\w-]+(\.[\w-]+)*@[\w-]+(\.[\w-]+)+$/;
            var ok = regExp.test(email);
            if(!ok){
                $("#emailRequierdSpan").text("邮格式不正确");
            }else{
                $("#emailRequierdSpan").text("");
            }
        }
    });
    $("#telephone").blur(function() {
        var mobile=this.value;
        mobile=$.trim(mobile);
        if(mobile==""){
            $("#telephoneRequierdSpan").text("电话号码不能为空");
        }else{
            var regExp =  /^1(3|4|5|6|7|8)\d{9}$/;
            var ok = regExp.test(mobile);
            if(!ok){
                $("#telephoneRequierdSpan").text("电话号码格式不正确");
            }else{
                $("#telephoneRequierdSpan").text("");
            }
        }
    });
    $("#reviseSubmit").click(function(){
        $(".form-control").blur();
        var flag=true;
        $.each($(".reviseRequierdSpan"),function(i,n){
            if(this.innerHTML!=""){
                flag=false;
                return false;
            }
        });
        if(!flag){
            $("#message").text("数据非法请检查!");
        }else{
            $("#reviseForm").submit();
        }
    });
//第二个表格的js代码
    var aEm=document.getElementsByTagName('em');
    var pwd=document.getElementById("input6");
    pwd.onkeyup=function(){
        if(this.value.length>6){
            aEm[1].className="active";
        }else {
            aEm[1].className="";
        }
        if(this.value.length>15){
            aEm[2].className="active";
        }else {
            aEm[2].className="";
        }
    };
    $("#newPwd").val(0);
    $("#checkPwd").val(0);
    $("#checkMail").val(0);
    $("#input6").blur(function() {
        var password=this.value;
        password=$.trim(password);
        if(password==""){
            $("#passwordRequierdSpan").text("密码不能为空");
            // $("#newPwd").val(false);
        }else{
            if(password.length<6 || password.length>26){
                $("#passwordRequierdSpan").text("密码要在6到26位之间");
                // $("#newPwd").val(false);
            }else{
                var regExp = /^[A-Za-z0-9]+$/;
                var ok = regExp.test(password);
                if(!ok){
                    $("#passwordRequierdSpan").text("密码不能含有特殊字符");
                    // $("#newPwd").val(false);
                }else{
                    $("#passwordRequierdSpan").text("");
                    $("#newPwd").val(1);
                }
            }
        }
    });
    $("#input7").blur(function(){
        var passwordAgain=this.value;
        var password=$("#input6").val();
        if(passwordAgain==password){
            $("#passwordAgainRequierdSpan").text("");
            $("#checkPwd").val(1);
        }else{
            $("#passwordAgainRequierdSpan").text("确认密码与密码不符");
            // $("#checkPwd").val(false);
        }
    });
    $("#getCode").click(function () {
        $.ajax({
            url:"/user/getCodeByEmail",
            type:"post",
            async:false,
            success:function (result) {
                if (result == "" || result == null){
                    alert("获取验证码失败,请重试！")
                }
                else {
                    alert("验证码已发送");
                    $("#codeValue").val(result);
                }
            }
        });
    });
    function f() {
        var codeValue = $("#codeValue").val();
        var checkCode = $("#checkCode").val();
        if (checkCode != codeValue || checkCode =="") {
            $("#codeRequierdSpan").text("请填写正确的验证码！");
            // $("#checkMail").val(false);
        }else {
            $("#codeRequierdSpan").text("");
            $("#checkMail").val(1);
        }
    }
    function RPwd() {
        f();
        var password=$("#input6").val();
        var r1=$("#checkMail").val();
        var r2=$("#newPwd").val();
        var r3=$("#checkPwd").val();
        // var r1 = $("#passwordRequierdSpan").innerText;
        // var r2 = $("#passwordAgainRequierdSpan").innerText;
        // var r3 = $("#codeRequierdSpan").innerText;
        if(r1 == 1 && r2 ==1 && r3 ==1){
            $.ajax({
                url:"/user/revisePassword",
                type:"post",
                data:{pwd:password},
                success:function(result){
                    if(result =="ok") {
                        alert("密码修改成功!请重新登录");
                        window.location.href="/user/logout";
                    }else {
                        alert("密码修改失败!请重试");
                    }
                }
                // error:function (XMLHttpRequest, textStatus, errorThrown) {
                //     alert(XMLHttpRequest.status);
                //     alert(XMLHttpRequest.readyState);
                //     alert(textStatus);
                // }
            });
        } else {
            alert("数据非法请检查!");
        }
    }


</script>
</html>